<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team DKS Log in</title>
	<meta name="author" content="Dulguun"/>
	<meta name="author" content="Khulan"/>
	<meta name="author" content="Sodbileg"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A platform for university students to connect, express their thoughts, and enjoy engaging conversations.">
    <meta name="keywords" content="University, Chat room, Discussion, Student">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" href="./assets/styles/base/_global.css">
    <link rel="stylesheet" href="./assets/styles/modules/login.css">
    <script>
        async function login() {
            const email = document.getElementById("email").value;
            const password = document.getElementById("password").value;
        
            try {
                const response = await fetch("http://localhost:3000/login", {
                    method: 'POST',
                    cache: "no-cache",
                    headers: {
                        "Content-Type": 'application/json; charset=UTF-8'
                    },
                    body: JSON.stringify({ email: email, password: password })
                });
        
                if (response.status !== 200) {
                    document.getElementById("incorrect").innerHTML = "Та нэвтрэх нэр эсвэл нууц үгээ шалгана уу.";
                    return;
                }
        
                const body = await response.json(); // Parse the response body as JSON
        
                // Check if the response contains cookies
                if (body.cookies) {
                    // Assuming your cookie is named 'session_id', you can access it as follows:
                    const sessionId = body.cookies.find(cookie => cookie.name === 'session_id');
        
                    if (sessionId) {
                        // Cookie found, update the UI
                        const header = document.getElementById("header-button");
                        header.classList.add("main-header__container2__user");
                        header.classList.remove("main-header__login-button");
                        header.classList.remove("main-header__signup-button");
                    }
                }
        
                // Redirect to index.html
                window.location.href = "index.html";
            } catch (error) {
                console.error('Error during login:', error);
            }
        }
        function logout() {
            fetch("http://localhost:3000/logout", {
                method: 'POST',
                cache: "no-cache",
                credentials: 'include', // Include credentials (cookies) in the request
                headers: {
                    "Content-Type": 'application/json; charset=UTF-8'
                }
            })
            .then(result => {
                console.log(result);
                if (result.status !== 200) {
                    document.alert = "Logout failed";
                    return;
                }
        
                // Remove the profile picture and logout button from the header
                const header = document.getElementById("header-button");
                const profilePicture = document.querySelector(".profile-picture");
                const logoutButton = document.querySelector(".logout-button");
        
                if (profilePicture) {
                    header.removeChild(profilePicture);
                }
        
                if (logoutButton) {
                    header.removeChild(logoutButton);
                }
        
                // Delete the cookie
                document.cookie = '';
        
                // Add back the login and signup buttons
                header.classList.remove("main-header__container2__user");
                header.classList.add("main-header__login-button");
                header.classList.add("main-header__signup-button");
                
                // Redirect to index.html
                window.location.href = "index.html";
            })
            .catch(error => {
                console.error('Error during logout:', error);
            });
        }
    </script>
</head>
<body>
    <main class="form-container">
        <p class="form-container__title">Нэвтрэх</p>
        <form class="form" >
            <p id="incorrect"></p>
            <div class="form__input-group">
                <label for="email">Цахим шуудан:</label>
                <input type="text" name="email" id="email" placeholder="" autofocus>
            </div>
            <div class="form__input-group">
                <label for="password">Нууц үг:</label>
                <input type="password" name="password" id="password" placeholder="">
                <div class="form__forgot">
                    <a rel="noopener noreferrer" href="#">Нууц үг мартсан?</a>
                </div>
            </div>
            <input type="button" value="Нэвтрэх" onclick="login()" class="btn form__sign" id="btn_login">
            <!-- <input type="submit" value="Нэвтрэх" class="btn form__sign" id="btn_login"> -->
        </form>
        <div class="social-message">
            <div class="social-message__line"></div>
            <p class="social-message__message">Хялбар нэвтрэлт</p>
            <div class="social-message__line"></div>
        </div>
        <div class="social-icons">
            <button aria-label="Log in with Google" class="social-icons__icon">
                <i class="fa-brands fa-google"></i>
            </button>
            <button aria-label="Log in with Twitter" class="social-icons__icon">
                <i class="fa-brands fa-facebook"></i>
            </button>
            <button aria-label="Log in with GitHub" class="social-icons__icon">
                <i class="fa-brands fa-instagram"></i>
            </button>
        </div>
        <p class="signup">Та бүртгэлгүй юу?
            <a rel="noopener noreferrer" href="#" class="">Бүртгүүлэх</a>
        </p>
    </main>
</body>
</html>